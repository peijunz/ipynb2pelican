# [ipynb2pelican](https://github.com/peijunz/ipynb2pelican) Plugin
[![Code Issues](https://www.quantifiedcode.com/api/v1/project/59dbe1a3f1a6424187e5f199f98e7aaf/badge.svg)](https://www.quantifiedcode.com/app/project/59dbe1a3f1a6424187e5f199f98e7aaf)

The [ipynb2pelican](https://github.com/peijunz/ipynb2pelican) plugin provides markup for Jupyter/IPython notebooks in pelican, so `.ipynb` files are recognized as a valid filetype for an article. 

## MetaCell
The project is inspired by [pelican-ipynb](https://github.com/danielfrg/pelican-ipynb), but do things the other way: MetaCell (i.e. Metadata Cell). 
With MetaCell, there is NO need to create another metadata file, or edit ipynb externally. Everything is inside Jupyter Notebook!

Exact Idea of MetaCell is:

> **All and Only** Metadata should be stored at the first Cell of ipynb

Writing a MetaCell is as simple as writting metadata in markdown file.
```md
# This is title
+ date: 2020-02-22
+ tags: hello, world
```
> Hint: In jupyter notebook, press `Esc+M` will switch selected cell to markdown mode. 

The `+` and space ` ` before any item will be automatically stripped out. If you don't like it, it's OK. But adding `+ ` will make metadata organized and enhance the readability of metacell:

### This is title
+ date: 2020-02-22
+ tags: hello, world

## Overview
The plugin is simple:

+ The CSS of jupyter will not be taken into outputs
+ The summary will be generated by Pelican

But it is still powerful and extensible:

+ Math Support
+ A Solution for metadata
+ Syntax hightlight by nbconvert
+ Several configurable preprocessors provided
    - Metadata Extraction
    - SubCell Selection
    - Ignore cells with `#ignore` tag
    - Empty Cell Removal
+ You can change [preprocess.py](preprocess.py) and define your own preprocessors

## Preprocessors
Thanks to the preprocessor feature of nbconvert, I have defined some useful
preprocessor with on/off options. In your `pelicanconf.py`, you are able to
set [options](#options) to toggle preprocessors. Don't worry about preprocessors, switch
off all options will have only 3% gain on performance according to the test on my blog. So
all of them are enabled by default.

### Metadata Extraction
As we stated, **All and Only** Metadata should be stored at the first Cell of ipynb. If there is non-metadata content found, it will raise an exception. After the extraction of metadata, the **MetaCell will be removed**, as we have extracted all the information. 

### Remove Empty Cells `IPYNB_REMOVE_EMPTY`
Remove trivial cells without visible characters using regular expression `\S`

### #ignore Tag `IPYNB_IGNORE`
You can include an `#ignore` comment at the beginning
of a cell of the Jupyter notebook to ignore it, removing it from the post content.

Note it is more strict than `#ignore` tag in pelican-ipynb. The purpose is to prevent kicking normal contents out of post content.

### SubCells Selection `IPYNB_SUBCELLS`
The Subcells preprocessor is executed after Metadata preprocessor (Th MetaCell it self will be removed by Metadata preprocessor), so
**zeroth cell is the first cell after MetaCell**. The start and end should be written in the MetaCell like:
```md
# This is title
+ date: 2020-02-22
+ tags: hello, world
+ subcells: [5, -1]
```

The value will be evaluated by `start, end = ast.literal_eval(value)`. And then cells are sliced by `cells[start:end]`.

> Hint: If you want end to be infinity, use None

## Options

|Option Variable|Default|Meaning|
|------|-------|-------|
|IPYNB_REMOVE_EMPTY|True|Remove Empty Cells|
|IPYNB_IGNORE|True|Remove cells with `#ignore` tag at the beginning|
|IPYNB_SUBCELLS|True|Only preserve Subcells specified by `subcells: [begin, end)` metadata|
|MATHJAX_CDN|[cdnjs](https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js)|The CDN of Mathjax to use|

## Installation and Configuration
### Dependency
+ Both `python2`, `python3` are supported
+ `pelican`
+ `jupyter`
+ `ipython`
+ `nbconvert`

I have tested on

+ `python 2.7/3.6`
+ `pelican 3.7.1`
+ `jupyter/ipython/nbconvert 4.1`

### Installation
Download this repo and rename folder to `ipynb2pelican`. Then put it
into your plugins directory. A simpler way is by submodule this plugin:

```sh
git submodule add git@github.com:peijunz/ipynb2pelican.git pelican-plugins/ipynb2pelican
```

If your plugins are put
into `pelican-plugins` directory, the file tree
should looks like:
```
content/
pelicanconf.py
pelican-plugins/
└── ipynb2pelican
    ├── __init__.py
    ├── math.py
    ├── preprocess.py
    ├── reader.py
    └── README.md
```
### Configuration
In the `pelicanconf.py`:
```python
MARKUP = ('md', 'ipynb')                # Add 'ipynb'
PLUGIN_PATH = ['pelican-plugins']       # Ensure your plugin path is in it
PLUGINS = ['ipynb2pelican']             # Name of the plugin
IGNORE_FILES = ['.ipynb_checkpoints']   # Prevent parsing checkpoints files
```

If you are not using `pelican-plugins`, you should change it accordingly.
## TODO
+ Bug for Math environment.
